<html>
<head>
	<meta charset="utf-8">
	<title>PyCharm Venv</title>
	<link rel="icon" href="https://maximalisimus.github.io/Articles/image/PyCharn-image/pycharm-icon.png">
	<link rel="shortcut icon" href="https://maximalisimus.github.io/Articles/image/PyCharn_image/favicon.ico" Type="image/x-icon">
	<link rel="stylesheet" href="https://maximalisimus.github.io/Articles/html/main.css" type="text/css">	
	<link rel="stylesheet" href="https://maximalisimus.github.io/Articles/html/zoom.css" type="text/css">
	<link rel="stylesheet" href="https://maximalisimus.github.io/Articles/html/table.css" type="text/css">
	<link rel="stylesheet" href="https://maximalisimus.github.io/Articles/html/frame.css">
	<link rel="stylesheet" href="https://maximalisimus.github.io/Articles/html/ol-li.css" type="text/css">
	<!-- <link rel="stylesheet" href="html/ol-li.css" type="text/css"> -->
	<script src="https://maximalisimus.github.io/Articles/html/jquery.2.2.0.min.js"></script>
	<script type="text/javascript" src="https://maximalisimus.github.io/Articles/html/litezoom.js"></script>
</head>
<body>
	<div class="site">
		<div class="header">
			<div id="logo">
				<p style="margin:10px; padding:0px;">PyCharm Venv</p>
			</div>
		</div>
		<div class="content">
			<center>
				<h1>Виртуальные окружения такие разные.</h1>
				<div class="images">
					<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/venv.jpg" width="500px"/>
				</div>
				<div style="clear:both"></div>
			</center>
		</div>
		<div class="content">
			<p><a name="oglavlenie"></a></p>
			<h2>Оглавление</h2>
			<ol>
				<li><a href="#part1">Введение</a></li>
				<li><a href="#part2">Исходные данные</a></li>
				<li><a href="#part3">Консоль</a></li>
				<li><a href="#part4">IDE PyCharm</a></li>
				<li><a href="#part5">Завершение</a></li>
			</ol>
		</div>
		<div class="content">
			<p><a name="part1"></a></p>
			<h1>Введение.</h1>
			<p>Часто бывает так, что при создании проекта в <b>PyCharm</b> не удаётся подключиться к созданному виртуальному окружению <b>.virtualenvs</b> через консоль.<br>
			Та же проблема возникает и при консольном режиме создании виртуального окружения - к нему не удаётся подключиться в <b>PyCharm</b>.</p>
			<p>	Сегодня, мы с вами <b><span style="color:Green;">правильно</span></b> создадим виртуальное окружение и подключим его в <b>PyCharm</b>. Оно будет работать как через консоль, так и в самом <b>IDE</b>.</p>
			<p><b>Однако, работать такой способ будет <span style="color:Red;">только</span> на <span style="color:Green;">ОС Linux</span>.</b></p>
			<p>Для <b>ОС Windows</b> пользоваться виртуальным окружением отдельно от самого <b>PyCharm</b> не получится.</p>
			<p>По крайней мере, мне, адекватно осуществить это так и не удалось.</p>
			<p><a href="#oglavlenie">Перейти к оглавлению</a>.</p>
		</div>
		<div class="content">
			<p><a name="part2"></a></p>
			<h1>Исходные данные</h1>
			<p>Для выполнения задачи я буду использовать временную папку: <b>~/002/</b></p>
			<p><span style="color:Red;">Однако, помните, что хранение и создание виртуальных окружений в базовых директориях может привести к выводу вашей системы из строя!</span>
			<br>
			<span style="color:Blue;">/; /home/; /home/&lt;UserName&gt;/;/boot/; /dev/; /etc/ и другие.</span>
			<br>
			<b>Лучше создайте для этого отдельную директорию и работайте только внутри неё!</b>
			<br>
			<span style="color:Green;">Например: /mnt/temp/; /mnt/002/; /home/&lt;UserName&gt;/001/; /home/&lt;UserName&gt;/temp/ и другие.</span>
			</p>
			<p>Пусть папка с проектом будет называться просто: <b>project</b></p>
			<p>Виртуальные окружения будут храниться в отдельной под-директории: <b>~/002/project/.virtualenvs</b></p>
			<p><b><span style="color:Red;">Обратите внимание</span></b>, что папку с проектом можно хранить <b>почти</b> в любой месте, а вот все виртуальные окружения лучше хранить либо в отдельной директории (так сказать центролизовано для данной системы), которая никогда не меняется, либо каждый раз создавать новую отдельную скрытую папку.
			<br>
			Последнее влияет только на ваше удобство работы.</p>
			<p><a href="#oglavlenie">Перейти к оглавлению</a>.</p>
		</div>
		<div class="content">
			<p><a name="part3"></a></p>
			<h1>Консоль</h1>
			<p>Перейдём непосредственно к самим настройкам.</p>
			<p>Первое что необходимо сделать - это создать определённый набор папок и файлов, с заданным содержимым.</p>
			<p><b>Обратите внимание, что все пути прописываются не полными, а относительно домашней директории пользователя!</b> Однако, вы можете прописывать их полными. Результат от этого не изменится. Просто строки с путями будут более длинными и сложными для вашего визуального восприятия.</p>
			<p class="codes">
				$ cd ~/002/</br>
				$ mkdir -p project/{.virtualenvs,.pycharm} && cd project && ls -lha</br>
				<span style="color:blue;"># Последняя команда в конвеере только для проверки результата</span>
			</p>
			<p>Файл активирования виртуального окружения внутри PyCharm.</p>
			<p class="codes">
				$ touch .pycharm/term-activate</br>
				$ echo "export PYCHARM_VENV=project-env" > .pycharm/term-activate
			</p>
			<p>Создаём основной файл подключения консоли PyCharm.</p>
			<p class="codes">
				$ nano .pycharmrc</br></br>
				<span style="color:blue;"># Содержимое файла .pycharmrc. Строки, на которые следует обратить внимание выделены зелёным цветом.</span></br>
				if [ -r "<span style="color:Green;">~/002/project/.pycharm/term-activate</span>" ]; then</br>
   				echo "Terminal activation hook detected."</br>
   				echo "Loading Bash profile..."</br>
   				<span style="color:Green;">source ~/002/project/.bashrc</span></br>
   				echo "Activating terminal hook..."</br>
   				<span style="color:Green;">source "~/002/project/.pycharm/term-activate"</span></br>
   				source activate $PYCHARM_VENV</br>
				fi</br>
				wait</br>
				<span style="color:Green;">cd ~/002/project/</span>
			</p>
			<p>Создаём файл с переменными окружения для работы виртуального.</p>
			<p class="codes">
				$ nano ~/002/project/.bashrc</br></br>
				<span style="color:Green;">export WORKON_HOME=$HOME/002/project/.virtualenvs</br>
				export PROJECT_HOME=$HOME/002/project/</span></br>
				export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python</br>
				export VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv</br>
				<span style="color:Blue;"># export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'</span></br>
				export PIP_VIRTUALENV_BASE=$WORKON_HOME</br>
				export PIP_RESPECT_VIRTUALENV=true</br>
				if [[ -r `which virtualenvwrapper.sh` ]]; then source `which virtualenvwrapper.sh`; fi
			</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-1.png" class="fz__minimized" alt="клик для увеличения" title="Create folders" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-2.png" class="fz__minimized" alt="клик для увеличения" title="Create virtualenvs" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-3.png" class="fz__minimized" alt="клик для увеличения" title="Create .pycharmrc" />
			</div>
			<p>Не забудьте создать самый простой файл <b>main.py</b> в корне проекта. В дальнейшем он понадобится при добавлении конфигурации запуска в <b>PyCharm</b>. Он нужен только для конфигураций <b>Run/Debug</b> в <b>PyCharm</b>. Однако, в этой же настройке указать можно любой файл запуска.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-4.png" class="fz__minimized" alt="клик для увеличения" title="main.py" />
			</div>
			<p>Только теперь переходим к созданию самого виртуального окружения и установки необходимых <b>pip</b> пакетов.</p>
			<p class="codes">
				$ source .bashrc</br>
				$ lsvirtualenv</br>
				$ mkvirtualenv project-env</br>
				<span style="color:blue;"># У вас будут свои списки pip пикетов. Здесь они приведены только для примера</span><br>
				$ pip install numpy scipy matplotlib networkx altgraph pyinstaller pyinstaller-hooks-contrib PyQT5 PyQT5-sip PyQT5-QT PyQT5-QT5</br>
				$ clear</br>
				$ pip list
			</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-5.png" class="fz__minimized" alt="клик для увеличения" title="pip command" />
			</div>
			<p>Теперь можно перейти к настройкам самого <b>PyCharm</b>.</p>
			<p><a href="#oglavlenie">Перейти к оглавлению</a>.</p>
		</div>
		<div class="content">
			<p><a name="part4"></a></p>
			<h1>IDE PyCharm</h1>
			<p>Добавляем проект - именно открываем его, указывая нашу папку без вложенных. Обязательно нажимаем кнопочку, что мы согласны открыть проект в режиме как есть - <b>Trust Project</b>.</p>
			<p class="codes">
				~/002/project/
			</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-6.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Open file or project" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-7.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Trust project" />
			</div>
			<p>Теперь откройте главное меню <b>File -> Settings</b>. Нас интересуют только разделы <b>Python interpreter</b> и <b>Terminal</b>.</p>
			<p>Дело в том, что когда мы создавали виртуальное окружение, у нас в нашей скрытой под-директории (в данном случае <i>~/002/project/.virtualenvs/project-env/bin/</i>) как бы, имеется отдельная версия интерпретатора. Да она ссылается на стандартную версию ( <i>/usr/bin/python</i> ), если вы не указывали другую. Однако, эта версия привязана к изменённому расположению пакетов вашего <b>pip</b>.</p>
			<p>Дело в том, что в других <i>IDE</i> для <i>Python</i> ( например, <i>sublime-text-3</i> ) в настройках именно за счет измененного расположения интерпретатора и привязок менеджера пакетов как раз и используется привязка плагинов к новому местоположению пакетов. Таким образом в них и работает автозавершение кода и нормальный запуск скриптов.</p>
			<p>Необходимо щелкнуть по шестеренке и добавить <b>Python</b> из нашего виртуального окружения. <b>По окончании работы с вашим проектом, необходимо будет здесь же, убрать из этого списка уже не существующий интерпретатор виртуального окружения.</b></p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-8.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Python interpreter" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-9.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Virtual environment" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-10.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Select Python venv" />
			</div>
			<p>Теперь необходимо перейти в раздел <b>Terminal</b> и указать файл <b>.pycharmrc</b>, который отвечает за настройку виртуального окружения в самом <b>PyCharm</b>.</p>
			<p class="codes">
				/bin/bash --rcfile ~/002/project/.pycharmrc
			</p>
			<p><b>По окончании работы с проектом, не забудьте также и здесь очистить строку от лишних частей. Т.е. оставить только: /bin/bash</b></p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-11.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Settings Terminal" />
			</div>
			<p>Базовая настройка завершена. Автозавершение кода уже должно подхватываться, а <b>pip</b> должен отвечать именно за наше виртуальное окружение.</p>
			<p>Остаётся только проверить наши настройки и настроить запуск проекта ( <i>Run/Debug</i> ) на выполнение.</p>
			<p>Ждём, когда <i>IDE</i> закончит индексирование пакетов и под-директорий, далее открываем закладку <i>Terminal</i> главного окна. Первое что мы должны увидеть - наше виртуальное окружение распозналась PyCharm-ом. При введении команды &laquo;pip list&raquo; мы должны увидеть только пакеты нашего виртуального окружения.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-12.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm Terminal" />
			</div>
			<p>Далее в правой верхней части окна открываем &laquo;Run/Debug Configuration&raquo;, добавляем наш <i>main.py</i> и выбираем интерпретатор. <b>Рекомендую</b> ставить <b>Default</b>. Вместо этого файла и названия конфигурации запуска можно указать любой другой файл проекта.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-13.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Run/Debug Configuration" />
			</div>
			<p>Снова переходим в терминал и если уже имеется файл с некой библиотекой - проверям и само виртуальное окружение внутри <i>PyCharm</i>.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-14.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Terminal" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-15.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Editor, Autocomplete" />
			</div>
			<p><a href="#oglavlenie">Перейти к оглавлению</a>.</p>
		</div>
		<div class="content">
			<p><a name="part5"></a></p>
			<h1>Завершение.</h1>
			<p>По окончании работы с проектом на главном окне, до запуска IDE, убрать проект из списка можно щелкнув по шестеренке справа от самого проекта.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-16.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Remove project" />
			</div>
			<p>Однако, это только уберет его из списка, но никак не удалить файлы и директории самого проекта.</p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-17.png" class="fz__minimized" alt="клик для увеличения" title="Remove project directory" />
			</div>
			<p><b>По окончании работы с вашим проектом, необходимо будет здесь же, убрать из этого списка уже не существующий интерпретатор виртуального окружения.</b></p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-8.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Python interpreter" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-9.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Virtual environment" />
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-10.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Select Python venv" />
			</div>
			<p><b>По окончании работы с проектом, не забудьте также и очистить строку терминала от лишних частей. Т.е. оставить только: /bin/bash</b></p>
			<div id="page" class="clearfix">
				<img src="https://maximalisimus.github.io/Articles/image/PyCharn_image/scr-11.png" class="fz__minimized" alt="клик для увеличения" title="PyCharm. Settings Terminal" />
			</div>
			<p><a href="#oglavlenie">Перейти к оглавлению</a>.</p>
		</div>
		<div class="content">
			<p>Ну а сегодня на этом всё. Всем Добра и Удачи!</p>
		</div>	
		<div class="about">
			<p>Copyright &copy; 17.06.2022 by <a href="mailto:maximalis171091@yandex.ru">Mikhail Artamonov</a></p>
		</div>
		</br>
	</div>
	<script type="text/javascript">$('.fz__minimized').litezoom({speed:400, viewTitle:true});</script>
</body>
</html>
